<script is:inline>
	(function initThemeSync() {
		if (typeof document === 'undefined') {
			return;
		}

		const getStoredTheme = () => {
			try {
				return typeof localStorage !== 'undefined' ? localStorage.getItem('theme') : null;
			} catch {
				return null;
			}
		};

		const getSystemPreference = () => {
			if (typeof window === 'undefined' || typeof window.matchMedia !== 'function') {
				return 'light';
			}
			return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
		};

		const applyTheme = theme => {
			document.documentElement.classList[theme === 'dark' ? 'add' : 'remove']('dark');
		};

		const theme = getStoredTheme() ?? getSystemPreference();
		applyTheme(theme);

		if (typeof MutationObserver === 'undefined') {
			return;
		}

		const observer = new MutationObserver(() => {
			const isDark = document.documentElement.classList.contains('dark');
			try {
				if (typeof localStorage !== 'undefined') {
					localStorage.setItem('theme', isDark ? 'dark' : 'light');
				}
			} catch {
				// ignore quota / private-mode errors
			}
		});

		observer.observe(document.documentElement, {
			attributes: true,
			attributeFilter: ['class']
		});
	})();
</script>
